{% extends "base.html" %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4 flex-wrap gap-3">
    <h2 class="fw-bold text-secondary mb-0">Системные сервисы</h2>
    
    <div class="d-flex flex-wrap gap-2 flex-grow-1 justify-content-lg-end">
        <input type="text" id="searchInput" onkeyup="filterServices()" class="form-control shadow-sm" placeholder="Поиск (напр. nginx)..." style="max-width: 300px; border-radius: 8px;">
        <button id="autoRefreshBtn" class="btn btn-secondary shadow-sm" onclick="toggleAutoRefresh()" style="border-radius: 8px; white-space: nowrap;">
            Автообновление: ВЫКЛ
        </button>
    </div>
</div>

<div class="card border-0 shadow-sm mb-4">
    <div class="card-body p-0">
        <div class="table-responsive" style="max-height: 75vh; overflow-y: auto;">
            <table class="table align-middle mb-0 text-nowrap">
                <thead class="table-light position-sticky top-0" style="z-index: 10;">
                    <tr>
                        <th class="ps-4">Статус</th>
                        <th>Название сервиса</th>
                        <th>Путь к исполняемому файлу</th>
                        <th class="pe-4 text-end">Действия</th>
                    </tr>
                </thead>
                <tbody id="servicesContainer">
                    {% for svc in services %}
                    <tr class="svc-row" id="row-{{ svc.name }}">
                        <td class="ps-4">
                            <span id="badge-{{ svc.name }}" class="badge {% if svc.active %}bg-success{% else %}bg-danger{% endif %} w-100">
                                {% if svc.active %}АКТИВЕН{% else %}ОСТАНОВЛЕН{% endif %}
                            </span>
                        </td>
                        <td class="fw-bold text-dark svc-name">{{ svc.name }}</td>
                        <td class="text-muted small font-monospace" style="max-width: 300px; overflow: hidden; text-overflow: ellipsis;" title="{{ svc.path }}">{{ svc.path }}</td>
                        <td class="pe-4 text-end">
                            <div class="d-flex justify-content-end gap-1">
                                <button id="toggle-btn-{{ svc.name }}" class="btn btn-sm {% if svc.active %}btn-outline-danger{% else %}btn-outline-success{% endif %} d-flex align-items-center justify-content-center p-1" onclick="botAction('{{ svc.name }}', '{% if svc.active %}stop{% else %}start{% endif %}')" title="{% if svc.active %}Остановить{% else %}Запустить{% endif %}" style="width: 32px; height: 32px;">
                                    <span class="material-symbols-outlined fs-6">{% if svc.active %}stop_circle{% else %}play_arrow{% endif %}</span>
                                </button>
                                <button class="btn btn-sm btn-outline-primary d-flex align-items-center justify-content-center p-1" onclick="botAction('{{ svc.name }}', 'logs')" title="Показать логи" style="width: 32px; height: 32px;">
                                    <span class="material-symbols-outlined fs-6">description</span>
                                </button>
                                <button class="btn btn-sm btn-outline-warning d-flex align-items-center justify-content-center p-1" onclick="botAction('{{ svc.name }}', 'restart')" title="Перезапустить" style="width: 32px; height: 32px;">
                                    <span class="material-symbols-outlined fs-6">sync</span>
                                </button>
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- Модальное окно: Полные логи -->
<div class="modal fade" id="fullLogsModal" tabindex="-1">
    <div class="modal-dialog modal-xl modal-dialog-centered">
        <div class="modal-content bg-dark" style="border-radius: 12px; border: none; overflow: hidden;">
            <div class="modal-header border-bottom-0 bg-dark text-light p-3">
                <h5 class="modal-title d-flex align-items-center gap-2" id="fullLogsTitle"></h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body p-0">
                <div class="log-box full-log-box" id="fullLogsContent" style="height: 70vh; padding: 15px; background: #1e1e1e; color: #4af626; font-family: monospace; overflow-y: auto; white-space: pre-wrap;">Загрузка...</div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="/static/js/services.js"></script>
{% endblock %}